\begin{lemma}[Ideal world balance]
\label{lemma:ideal-balance}
  Consider an ideal execution with functionality \fchan and simulator
  \simulator.
  Let $P \in \{\alice, \bob\}$ one of the two parties of \fchan and $\bar{P}$
  the other party. Assume that all of the following are true:
  \begin{itemize}
    \item the internal variable $\texttt{ignore}_P$ of \fchan has the value
    ``False'',
    \item \fchan has received $(\textsc{open}, c)$ by \simulator,
    \item \fchan has received $(\textsc{fund}, f_i, P)$ by \simulator while
    \textit{State} was \textsc{open} $n \geq 0$ times,
    \item \fchan has received $(\textsc{pay}, d_i, P, \bar{P})$ by \simulator
    while \textit{State} was \textsc{open} $m \geq 0$ times,
    \item \fchan has received $(\textsc{pay}, e_i, \bar{P}, P)$ by \simulator
    while \textit{State} was \textsc{open} $l \geq 0$ times.
  \end{itemize}
  Let $\phi = 1$ if $P = \alice$, or $\phi = 0$ if $P = \bob$. If \fchan
  receives $(\textsc{close}, P)$ or $(\textsc{close}, \bar{P})$ by \simulator,
  then the following holds with overwhelming probability on the security
  parameter:
  \begin{equation}
    \texttt{balance}_P = \phi \cdot c - \sum\limits_{i=1}^n f_i -
    \sum\limits_{i=1}^m d_i + \sum\limits_{i=1}^l e_i
  \end{equation}
\end{lemma}

\begin{proof}
  \TODO{continue}
\end{proof}
