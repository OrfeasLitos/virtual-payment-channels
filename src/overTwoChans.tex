\section{Virtual channel over 2 normal channels}
  We use the term "base channels" for the channels described
  in~\cite{lightning}. We adopt the notation of
  Perun~\cite{DBLP:conf/ccs/DziembowskiFH18} to differentiate base and virtual
  channels: $\mathit{Peggy} \Leftrightarrow \mathit{Quinney}$ refers to a base
  channel and $\mathit{Peggy} \leftrightarrow \mathit{Quinney}$ refers to a
  virtual channel.

  Figures~\ref{fig:base:alice} and~\ref{fig:base:bob} show the transactions that
  two parties hold in an existing base channel between them, as described
  in~\cite{lightning}\footnote{In the lightning spec
  (\url{https://github.com/lightningnetwork/lightning-rfc/}) really}. Let
  existing $\alice \Leftrightarrow \bob, \bob \Leftrightarrow \charlie$ base
  channels, with an $\alice \leftrightarrow \charlie$ virtual channel on top.
  Fig.\TODO{~ref{fig:virt}} shows the transactions that the three parties hold.

  \begin{itemize}
    \item On-chain outputs:
    \begin{itemize}
      \item $\mathtt{funding}_{\mathrm{AB}} = \txout(\alice_{F, 1} \wedge
      \bob_{F, 1}, a + a' + c' + b_1)$
      \item $\mathtt{funding}_{\mathrm{BC}} = \txout(\bob_{F, 2} \wedge
      \charlie_{F, 2}, b_2 + c)$
    \end{itemize}
    \item Txs held by \alice:
    \begin{itemize}
      \item $\mathtt{baseCommitment}_{\alice} = \tx($ \\
        $(\txin(\mathtt{funding}_{\mathrm{AB}})),$ \\
        $(\mathtt{base} = \txout(\alice_{F', 1} \wedge \bob_{F', 1}, a + b_1),$
        \\
        $\mathtt{virt} = \txout(\rdel(\alice_{F', 2} \wedge \charlie_{F', 2},
        \mathtt{bobDelay}) \vee \bob_{\mathrm{rev}, 1}, a' + c'),$ \\
        $\mathtt{mark}_{\alice} = \txout(\alice_{M, 1} \wedge \bob_{M, 1} \wedge
        \charlie_{M, 1}, 0)))$
      \item $\mathtt{ABcommitment}_{\alice} = \tx($ \\
        $(\txin(\mathtt{baseCommitment}_{\alice}, \mathtt{base})),$ \TODO{common
        keys make this incomplete} \\
        $(\txout(\rdel(\alice_{\mathrm{dcom}, 1}, \mathtt{bobDelay}) \vee
        \bob_{\mathrm{rev}, 2}, a),$ \\
        $(\txout(\bob_{\mathrm{com}, 1}, b_1))))$
      \item $\mathtt{ACcommitment}_{\alice} = \tx($ \\
        $(\txin(\mathtt{baseCommitment}_{\alice}, \mathtt{virt})),$ \\
        $(\txout(\rdel(\alice_{\mathrm{dcom}, 2}, \mathtt{charlieDelay}) \vee
        \charlie_{\mathrm{rev}, 1}, a'),$ \\
        $(\txout(\charlie_{\mathrm{com}, 1}, c'))))$
    \end{itemize}
    \item Txs held by \bob:
    \begin{itemize}
      \item
      \item
      \item
    \end{itemize}
    \item Txs held by \charlie:
    \begin{itemize}
      \item
    \end{itemize}
  \end{itemize}
