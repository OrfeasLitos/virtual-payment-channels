\section{Virtual channel over 2 normal channels}
  We use the term ``base channels'' for channels in the \textsc{open base} state
  and ``virtual channels'' for those in the \textsc{open virtual} state. We
  adopt the notation of Perun~\cite{DBLP:conf/ccs/DziembowskiFH18} to
  differentiate base and virtual channels: $\mathit{Peggy} \Leftrightarrow
  \mathit{Quinney}$ refers to a base channel and $\mathit{Peggy} \leftrightarrow
  \mathit{Quinney}$ refers to a virtual channel.

  Figures~\ref{fig:base:alice} and~\ref{fig:base:bob} show the transactions that
  two parties hold in an existing base channel between them, as described
  in~\cite{lightning}\footnote{In the lightning spec
  (\url{https://github.com/lightningnetwork/lightning-rfc/}) in more detail}.
  Let existing $\alice \Leftrightarrow \bob, \bob \Leftrightarrow \charlie$ base
  channels, with an $\alice \leftrightarrow \charlie$ virtual channel on top.
  Fig.\TODO{~ref{fig:virt}} shows the transactions that the three parties hold.

  \begin{itemize}
    \item On-chain outputs:
    \begin{itemize}
      \item $\mathtt{funding}_{\mathrm{AB}} = \txout(\alice_{F} \wedge
      \bob_{F, \mathrm{source}}, a + a' + c' + b_{\mathrm{w/src}})$
      \item $\mathtt{funding}_{\mathrm{BC}} = \txout(\bob_{F, \mathrm{dest}}
      \wedge \charlie_{F}, b_{\mathrm{w/dest}} + c)$
    \end{itemize}
    \item Txs held by \alice:
    \begin{itemize}
      \item $\mathtt{baseCommitment}_{\alice} = \tx($ \\
        $(\txin(\mathtt{funding}_{\mathrm{AB}})),$ \\
        $(\mathtt{base} = \txout(\alice_{F, \mathrm{base}} \wedge \bob_{F, AB,
        \mathrm{base}}, a + b_{\mathrm{w/src}}),$ \\
        $\mathtt{virt} = \txout(\rdel(\alice_{F, \mathrm{virt}} \wedge
        \charlie_{F, \mathrm{virt}}, \mathtt{bobDelay}) \vee \\
        \bob_{\mathrm{rev}, \mathrm{virt}}, a' + c'),$ \\
        $\mathtt{mark}_{\alice} = \txout(\alice_{M, \mathrm{source}} \wedge
        \bob_{M, \mathrm{source}} \wedge \charlie_{M, \mathrm{source}}, 0)))$
      \item $\mathtt{ABcommitment}_{\alice} = \tx($ \\
        $(\txin(\mathtt{baseCommitment}_{\alice}, \mathtt{base})),$ \TODO{common
        keys make this incomplete - fix all inputs} \\
        $(\txout(\rdel(\alice_{\mathrm{dcom}, \mathrm{base}}, \mathtt{bobDelay})
        \vee \bob_{\mathrm{rev}, \mathrm{base}}, a),$ \\
        $(\txout(\bob_{\mathrm{com}, \mathrm{base}}, b_{\mathrm{w/src}}))))$
      \item $\mathtt{ACcommitment}_{\alice} = \tx($ \\
        $(\txin(\mathtt{baseCommitment}_{\alice}, \mathtt{virt})),$ \\
        $(\txout(\rdel(\alice_{\mathrm{dcom}, 2}, \mathtt{charlieDelay}) \vee
        \charlie_{\mathrm{rev}, 1}, a'),$ \\
        $(\txout(\charlie_{\mathrm{com}, 1}, c'))))$
    \end{itemize}
    \item Txs held by \bob:
    \begin{itemize}
      \item
      \item
      \item
    \end{itemize}
    \item Txs held by \charlie:
    \begin{itemize}
      \item
    \end{itemize}
  \end{itemize}
  \TODO{choose and homogenize tx names (in list \& figures)}
