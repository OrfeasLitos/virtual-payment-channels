\begin{figure}[H]
  \begin{simulatorbox}{\simulator}
    \begin{algorithmic}[1]
      \State On $(\textsc{open}, c_F, pk_{A, \mathrm{out}}, pk_{B,
      \mathrm{out}}, F, \alice)$ by \fchan:
      \Indent
        \State simulate \alice receiving input $(\textsc{open}, c_F, pk_{A,
        \mathrm{out}}, pk_{B, \mathrm{out}})$ by \environment
        \State ensure simulated \alice outputs (\textsc{ok})
        \State send (\textsc{ok}) to \fchan
      \EndIndent
      \Statex

      \State On (\textsc{pay}, $x$, \dave) by \fchan:
      \Indent
        \State simulate \dave receiving input (\textsc{pay}, $x$) by \environment
        \State ensure simulated \dave outputs (\textsc{ok})
        \State send (\textsc{ok}) to \fchan
      \EndIndent
      \Statex

      \State On (\textsc{fund you}, $c$, \bob, \charlie, \alice) by \fchan:
      \Indent
        \State simulate \alice receiving input (\textsc{fund you}, $c$, \bob) by
        \charlie
        \State ensure simulated \alice outputs (\textsc{ok}) to \charlie
        \State send (\textsc{ok}) to \fchan
      \EndIndent
      \Statex

      \State On (\textsc{fund} $c$, hops, \texttt{sub\_parties} = (fundee,
      counterparty), \texttt{outer\_parties} = (\charlie, \dave),
      \texttt{funder} = \alice) by \fchan:
      \Indent
        \State simulate receiving the message without the last element with
        \alice, executing only line~\ref{code:protocol:chan:skeleton:vchan} of
        Fig.~\ref{code:protocol:chan:skeleton:virtual}
        \State ensure VChan() is successful
        \State send (\textsc{ok}) to \fchan
      \EndIndent
    \end{algorithmic}
  \end{simulatorbox}
  \caption{}
  \label{code:simulator}
\end{figure}
