\makeatletter%
\@ifclassloaded{IEEEtran}%
  {\paragraph{Related work}}%
  {\paragraph{Related work.}}%
\makeatother%
 The first proposal for PCNs~\cite{spilman} only enabled
 unidirectional payment channels. As mentioned previously, DMCs~\cite{decker}
 with their decrementing timelocks have the shortcoming of limited channel
 lifetime. This was ameliorated by LN~\cite{lightning} which has become the dominant paradigm for designing Bitcoin-compatible PCNs.
 LN is currently implemented and operational for
  Bitcoin. It has also been adapted for Ethereum~\cite{wood2014ethereum}, named Raiden Network.

Various attacks have been identified against LN. The wormhole
  attack~\cite{DBLP:conf/ndss/MalavoltaMSKM19} against LN allows
  colluding parties in a multi-hop payment to steal the fees of the
  intermediaries between them and Flood \& Loot attacks~\cite{10.1145/3419614.3423248}
  analyses an attack in which too many channels are forced to
  close in a short amount of time, harming blockchain liveness and enabling
  a malicious party to steal off-chain funds.

  To the best of our knowledge, no formal treatment of the privacy of LN exists.
  Nevertheless, it intuitively improves upon the privacy of on-chain Bitcoin
  transactions, as LN payments do not leave a permanent record: only
  intermediaries of each payment are informed. It can be argued that Elmo
  further improves privacy, as payments are hidden from
  the intermediaries of a virtual channel.

  Payment routing~\cite{spider,prihodko2016flare,lee2020routee} is another research area that aims to improve network efficiency without sacrificing  privacy. Actively rebalancing channels~\cite{DBLP:conf/ccs/KhalilG17} can
  further increase network efficiency by reducing unavailable routes due to lack of well-balanced funds.

  An alternantive payment channel construction for Bitcoin that aspires to be
  the successor of Lightning is eltoo~\cite{eltoo}. It is conceptually simpler,
  has smaller on-chain footprint and a more forgiving attitude towards
  submitting an old channel state than Lightning (as the old state is superseded without punishment), but it needs
  \texttt{ANYPREVOUT}. Compared to Elmo, eltoo is more lightweight in terms of
  storage and communication when setting up, but suffers from increased latency
  and communication for payments, as intermediaries have to actively participate
  in multi-hop payments. It also suffers in terms of privacy, as intermediaries
  learn the exact time and value of each payment. On a related note, the payment
  logic of Elmo could also be designed based on the eltoo mechanism instead of
  the currently leveraged LN techniques.

  Bolt~\cite{10.1145/3133956.3134093} constructs privacy-preserving payment
  channels enabling both direct payments and payments with a single untrusted
  intermediary. Sprites~\cite{sprites} leverages the scripting language of
  E\-the\-re\-um to decrease the time collateral is locked compared to LN.

  State channels are a generalisation of payment channels, which enable
  off-chain execution of any smart contract supported by the underlying
  blockchain, not just payments. Generalized Bitcoin-Compatible
  Channels~\cite{DBLP:journals/iacr/AumayrEEFHMMR20} enable the creation of
  state channels on Bitcoin, extending channel functionality from simple
  payments to arbitrary Bitcoin scripts. Since Elmo only pertains to payment,
  not state, channels, we choose not to build it on top
  of~\cite{DBLP:journals/iacr/AumayrEEFHMMR20}. State channels can also be
  extended to more than two
  parties~\cite{DBLP:conf/asiaccs/LiaoZSS22,DBLP:conf/eurocrypt/DziembowskiEFHH19}.

  Perun~\cite{perun} and GSCN~\cite{DBLP:conf/ccs/DziembowskiFH18} exploit the
  Turing-complete scripting language of Ethereum to provide virtual state
  channels, i.e., state channels that can open without an on-chain transaction.
  % GSCN also uses a per-channel functionality and a similar recursive argument
  % as we use in our UC-security analysis. Their security argument is however
  % flawed, as they incorrectly argue that every level is subroutine respecting
  % with respect to the same environment and subroutines.
  We believe that, given the versatile scripting of Ethereum, GSCN could be
  extended to support variadic channels in a straightforward manner. Similar
  features are provided by Celer~\cite{dong2018celer}.
  Hydra~\cite{cryptoeprint:2020:299} provides state channels for the
  Cardano~\cite{cardano} blockchain.

  BDW~\cite{scalable-funding} shows how pairwise channels over Bitcoin can be
  funded with no on-chain transactions by allowing parties to form groups that
  can pool their funds together off-chain and then use those funds to open
  channels. Such proposals are complementary to virtual channels and, depending
  on the usecase, could be more efficient. In comparison to Elmo, BDW is less
  flexible: coins in a BDW pool can only be exchanged with members of that
  pool. ACMU~\cite{10.1145/3319535.3345666} allows for multi-path atomic
  payments with reduced collateral, enabling new applications such as
  crowdfunding conditional on reaching a funding target.

  TEE-based~\cite{zhao2019sok}
solutions~\cite{teechan,10.1145/3341301.3359627,DBLP:conf/asiaccs/LiaoZSS22,lee2020routee}
  improve the throughput and efficiency of PCNs by an order of magnitude or
  more, at the cost of having to trust TEEs. Brick~\cite{avarikioti2020brick}
  uses a partially trusted committee to extend PCNs to fully asynchronous
  networks.

  Solutions alternative to PCNs include side\-chains
  (e.g.,~\cite{BCDF+14,sidechains,KiaZin18}), commit-chains
  (e.g.,~\cite{plasma}), non-custo\-dial chains
  (e.g.,~\cite{plasma,konstantopoulos2019plasma,plasma-lower-bounds}),
  and partially centralised payment networks that entirely avoid using a
  blockchain~\cite{DBLP:conf/trust/ArmknechtKMYZ15,stellar,silentwhispers,DBLP:conf/ndss/RoosMKG18}.

  Last but not least, a number of works propose virtual channel constructions
  for Bitcoin. Lightweight Virtual Payment
  Channels~\cite{10.1007/978-3-030-65411-5_18} enables a virtual channel to be
  opened on top of two preexisting channels and uses a technique similar to DMC,
  unfortunately inheriting the fixed lifetime limitation.
  Let \emph{simple channels} be those built directly on-chain, i.e., channels that are not
  virtual.
  Bitcoin-Compatible Virtual Channels~\cite{9519487} also enables
  virtual channels on top of two preexisting simple channels
  and offers two protocols, the first of which guarantees that the channel will
  stay off-chain for an agreed period, while the second allows the single intermediary
  to turn the virtual into a simple channel.
  This strategy has the shortcoming that even if it is made
  recursive (a direction left open in~\cite{9519487}) after $k$
  applications of the constructor the virtual channel participant will have to
  publish on-chain $k$ transactions in order to close the channel if all
  intermediaries actively monitor the blockchain.

  Donner~\cite{donner}
    (released originally concurrently with the first technical report release of our work) 
%  is the first work 
%  to 
achieves also variadic
  virtual channels, but without recursion nor features that are not yet
  available in Bitcoin. This is achieved by having the funder lock as
  collateral twice the amount of the desired channel funds: once on-chain with
  funds that are external to the \emph{base channels} (i.e., the channels that the
  virtual channel is based on) and once off-chain within its base channel. Thus
  the required collateral for the funder is double that of other protocols and
  a party lacking sufficient on-chain coins cannot fund a Donner channel;
  additionally, we conjecture that using external coins precludes variadic
  virtual channel designs that are not encumbered with limited lifetime. This
  design choice further means that Donner is not symmetric. Donner also uses
  placeholder outputs which, due to the minimum coins they need to carry to
  exceed Bitcoin's \emph{dust limit}, may skew the incentives of rational players
  and adds to the
  opportunity cost of maintaining a channel. Further, its design complicates
  future iterations that lift its current restriction that only one of the two
  channel parties can fund the virtual channel. The aforementioned incentives
  together with its lack of recursiveness mean that if a party with coins in a
  Donner channel decides to use them with another party, it first has to close
  its channel on-chain, with all the delays and fees this entails.
  On the positive side, Donner is
  more efficient than Elmo in terms of storage, computation and communication
  complexity, and boasts a simpler design. 
  %, but has less room for optimisations and is not recursive. 
  Their work also introduces the \emph{Domino attack},
  which we adress in detail in Section~\ref{sec:future-work}.

  Furthermore,  Donner as described in~\cite{donner}, 
  is insecure because any state update to a base
  channel invalidates the corresponding $\mathsf{tx}^r$. There is a
  straightforward fix, which however introduces an overhead to each payment over
  any base channel: On every payment, the two base channel parties must update
  their $\mathsf{tx}^r$ to spend the $\alpha$ output of the new state. Potential
  intermediaries must consider this overhead and possibly increase the fees they
  require from the endpoints. Note this per-payment overhead can be avoided by using
  ANYPREVOUT in the $\alpha$ output.

  Table~\ref{table:comparison-features} contains a comparison of the
  features and limitations of virtual channel protocols, including the one put
  forth in this work.

  \begin{table*}
    \caption{Features \& requirements comparison of virtual channel protocols}
    \label{table:comparison-features}
    \begin{minipage}{\textwidth}
    \begin{center}
    \begin{tabular}{|l|c|c|c|c|c|}
    \hline
              & Unlimited lifetime & Recursive & Variadic & Symmetric & Script requirements \\
    \hline
    LVPC~\cite{10.1007/978-3-030-65411-5_18}
              & ✗                  & \LEFTcircle\footnote{lacks security analysis}
                                               & ✗         & ✓         & Bitcoin \\
    \hline
    BCVC~\cite{9519487}
              & ✓                  & ✗         & ✗         & ✓         & Bitcoin \\
    \hline
    Perun~\cite{perun}
              & ✓                  & ✗         & ✗         & ✓         & Ethereum \\
    \hline
    GSCN~\cite{DBLP:conf/ccs/DziembowskiFH18}
              & ✓                  & ✓         & ✗         & ✓        & Ethereum \\
    \hline
    Donner~\cite{donner}
              & ✗                  & ✗         & ✓         & ✗         & Bitcoin \\
    \hline
    this work & ✓                  & ✓         & ✓         & ✓         & Bitcoin + \texttt{ANYPREVOUT} \\
    \hline
    \end{tabular}
    \end{center}
    \end{minipage}
  \end{table*}
